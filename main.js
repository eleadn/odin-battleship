(()=>{"use strict";var t={56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var s={},o=[],a=0;a<t.length;a++){var l=t[a],c=i.base?l[0]+i.base:l[0],p=s[c]||0,d="".concat(c," ").concat(p);s[c]=p+1;var h=n(d),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)e[h].references++,e[h].updater(u);else{var m=r(u,i);i.byIndex=a,e.splice(a,0,{identifier:d,updater:m,references:1})}o.push(d)}return o}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var s=i(t=t||[],r=r||{});return function(t){t=t||[];for(var o=0;o<s.length;o++){var a=n(s[o]);e[a].references--}for(var l=i(t,r),c=0;c<s.length;c++){var p=n(s[c]);0===e[p].references&&(e[p].updater(),e.splice(p,1))}s=l}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},208:(t,e,n)=>{n.d(e,{A:()=>a});var i=n(601),r=n.n(i),s=n(314),o=n.n(s)()(r());o.push([t.id,"* {\n\tmargin: 0;\n}\n\n#homeView,\n#gameboardView,\n#endgameView {\n\theight: 100vh;\n\tdisplay: flex;\n\n\tflex-direction: column;\n\tjustify-content: center;\n\talign-items: center;\n\tgap: 20px;\n}\n\n.board {\n\tdisplay: grid;\n\n\tgrid-template-columns: repeat(10, 30px);\n\tgrid-template-rows: repeat(10, 30px);\n}\n\n.board > .cell-opponent {\n\tborder-top: none;\n\tborder-bottom: 1px solid red;\n\tborder-left: none;\n\tborder-right: 1px solid red;\n\tbackground-color: white;\n}\n\n.board > .cell-opponent.cell-top {\n\tborder-top: 1px solid red;\n}\n\n.board > .cell-opponent.cell-left {\n\tborder-left: 1px solid red;\n}\n\n.board > .cell-opponent.attack-hit {\n\tbackground-color: indianred;\n\tborder-color: darkred;\n}\n\n.board > .cell-opponent.attack-sunk {\n\tbackground-color: darkred;\n\tborder-color: darkred;\n}\n\n.board > .cell-opponent.attack-fail {\n\tbackground-color: dimgray;\n\tborder-color: black;\n}\n\n.board > .cell-friendly {\n\tborder-bottom: 1px solid black;\n\tborder-right: 1px solid black;\n}\n\n.board > .cell-friendly.cell-top {\n\tborder-top: 1px solid black;\n}\n\n.board > .cell-friendly.cell-left {\n\tborder-left: 1px solid black;\n}\n\n.board > .cell-friendly.ship {\n\tbackground-color: aqua;\n\tborder-color: blue;\n}\n\n.board > .cell-friendly.attack-hit {\n\tbackground-color: indianred;\n\tborder-color: darkred;\n}\n\n.board > .cell-friendly.attack-sunk {\n\tbackground-color: #333333;\n\tborder-color: black;\n}\n\n.board > .cell-friendly.attack-fail {\n\tbackground-color: aquamarine;\n}\n",""]);const a=o},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,r,s){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<t.length;c++){var p=[].concat(t[c]);i&&o[p[0]]||(void 0!==s&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=s),n&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=n):p[2]=n),r&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=r):p[4]="".concat(r)),e.push(p))}},e}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={id:i,exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;class i{static#t=new Map;static listen(t,e){const n=this.#t.get(t)??[];n.push(e),this.#t.set(t,n)}static unlisten(t,e){const n=this.#t.get(t);void 0!==n&&this.#t.set(t,n.filter((t=>t!==e)))}static emit(t,...e){const n=this.#t.get(t);if(void 0!==n)for(const t of n)t(...e)}static query(t,...e){const n=this.#t.get(t);if(n?.length>0)return n?.length>1&&console.warn(`EventBus.query(${t}) called but multiple handlers are registered.`),n[0](...e)}}const r=(t,e)=>{const n=t.attacks.find((t=>t.position.x===e.x&&t.position.y===e.y));let i=null;return n.ship&&(i={sunk:n.ship.isSunk(),position:{x:n.ship.position.x,y:n.ship.position.y},length:n.ship.length,isUp:n.ship.isUp}),{position:e,hit:n.hit,ship:i}},s=(()=>{const t={carrier:5,battleship:4,destroyer:3,submarine:3,patrolBoat:2};return{getBoardSize:()=>10,getShips:()=>new Object({...t})}})();class o{#e;#n;#i;#r;constructor(t,e,n){this.#e=e,this.#n=[],this.#i=t,this.#r=n}get length(){return this.#e}get hits(){return this.#n}get hitCount(){return this.#n.length}get position(){return this.#i}get isUp(){return this.#r}hit(t){this.#n.push(t)}isSunk(){return this.hitCount>=this.#e}}class a{#s;#o;#a;constructor(t){this.#s=[],this.#o=[],this.#a=t}get ships(){return this.#s}get totalShips(){return this.#s.length}get totalAttacksCount(){return this.#o.length}get attacks(){return this.#o}get areAllShipSunk(){return 0===this.#s.length||this.#s.every((t=>t.isSunk()))}addShip(t,e,n,i){const r={x:t,y:e};this.#l(r.x)&&this.#l(r.y)&&(i&&this.#l(r.y+n-1)||this.#l(r.x+n-1))&&this.#c(r,n,i)}getPossibleAttacks(){const t=[];for(let e=0;e<this.#a;++e)for(let n=0;n<this.#a;++n)this.#o.some((t=>t.position.x===n&&t.position.y===e))||t.push({x:n,y:e});return t}getPossiblePositions(t){const e=[];for(let n=0;n<this.#a;++n)for(let i=0;i<this.#a;++i){const r={x:i,y:n},s=new o(r,t,!0),a=new o(r,t,!1);!this.#p(s)&&this.#l(r.y+t-1)&&e.push({position:r,length:t,isUp:!0}),!this.#p(a)&&this.#l(r.x+t-1)&&e.push({position:r,length:t,isUp:!1})}return e}receiveAttack(t,e){const n={x:t,y:e};if(n.x<0||n.x>=this.#a||n.y<0||n.y>=this.#a||this.#o.some((t=>t.position.x===n.x&&t.position.y===n.y)))return!1;const i=this.#s.find((t=>this.#d(t,n))),r=!!i;return this.#o.push({position:n,hit:r,ship:i}),!0}#d(t,e){const n=t.isUp?t.position.x:t.position.y,i=t.isUp?t.position.y:t.position.x,r=i+t.length-1,s=t.isUp?e.x:e.y,o=t.isUp?e.y:e.x;return n===s&&i<=o&&o<=r&&(t.hit(o-i),!0)}#l(t){return t>=0&&t<this.#a}#c(t,e,n){const i=new o(t,e,n);this.#p(i)||this.#s.push(i)}#p(t){return this.#s.some((e=>this.#h(t,e)))}#h(t,e){return t.isUp!==e.isUp?this.#u(t,e):this.#m(t,e)}#u(t,e){const n=t.isUp?t:e,i=t.isUp?e:t,r=i.position.x-n.position.x,s=i.position.x+i.length-1,o=n.position.x-s,a=Math.max(r,o),l=Math.max(0,a),c=n.position.y-i.position.y,p=n.position.y+n.length-1,d=i.position.y-p,h=Math.max(c,d),u=Math.max(0,h);return l>0&&u>0?l+u<=2:l+u<=1}#m(t,e){const n=t.isUp?t.position.x:t.position.y,i=t.isUp?e.position.x:e.position.y,r=t.isUp?t.position.y:t.position.x,s=t.isUp?e.position.y:e.position.x,o=Math.abs(n-i),a=r+t.length-1,l=s+e.length-1,c=Math.max(r,s),p=Math.min(a,l),d=Math.max(0,c-p);return o>0&&d>0?o+d<=2:o+d<=1}}const l="bot",c={player1:{name:"Player",type:"human",gameboard:new a(s.getBoardSize())},player2:{name:"Bot",type:l,gameboard:new a(s.getBoardSize())}},p={players:c,currentPlayer:"player1"};class d{#y;constructor(t){this.#y=t}get root(){return this.#y}render(){if("function"!=typeof this.renderContent)throw new Error("View must implement renderContent()");this.#y.innerHTML="",this.renderContent()}unRender(){}}class h extends d{#g;constructor(t,e){super(t),this.#g=e}renderContent(){const t=document.createElement("div");t.id="endgameView";const e=document.createElement("h1");e.textContent=`${this.#g} wins !`;const n=document.createElement("button");n.textContent="Replay",n.addEventListener("click",(()=>i.emit("game:startRequest"))),t.appendChild(e),t.appendChild(n),this.root.appendChild(t)}}class u extends d{#a;#b;#f;#k;#v;#S;#x;#C;#w;constructor(t,e){super(t),this.#a=e,this.#v=t=>this.updateShipBoard(t),this.#S=t=>this.onOpponentReceiveAttack(t),this.#x=t=>this.onPlayerReceiveAttack(t),this.#C=t=>this.updateTitle(t),i.listen("game:shipPlacementChanged",this.#v),i.listen("game:opponentReceiveAttack",this.#S),i.listen("game:playerReceiveAttack",this.#x),i.listen("game:startTurn",this.#C),this.#w=t=>this.#T(t)}#T(t){i.emit("ui:opponentCellClicked",t.currentTarget.position),t.currentTarget.removeEventListener("click",this.#w)}#P(t){const e=document.createElement("h2");e.textContent="{CurrentPlayer} turn",t.appendChild(e),this.#k=e}#B(t){const e=document.createElement("div");e.classList.add("board");for(let t=0;t<this.#a;++t)for(let n=0;n<this.#a;++n){const i=document.createElement("button");i.classList.add("cell-opponent"),0===n&&i.classList.add("cell-left"),0===t&&i.classList.add("cell-top"),i.position={x:n,y:t},i.addEventListener("click",this.#w),e.appendChild(i)}t.appendChild(e),this.#f=e}#A(t){const e=document.createElement("div");e.classList.add("board");for(let t=0;t<this.#a;++t)for(let n=0;n<this.#a;++n){const i=document.createElement("div");i.classList.add("cell-friendly"),0===n&&i.classList.add("cell-left"),0===t&&i.classList.add("cell-top"),e.appendChild(i)}t.appendChild(e),this.#b=e}#E(t){const e=t.isUp?t.position.x:t.position.y,n=t.isUp?t.position.y:t.position.x,i=n+t.length;for(let r=n;r<i;++r){const i=(t.isUp?e:r)+(t.isUp?r:e)*this.#a,s=this.#b.children[i],o=t.hitIndexes.some((t=>t===r-n));s.classList.remove(["ship-sunk","ship-hit","ship"]),t.isSunk?s.classList.add("ship-sunk"):o?s.classList.add("ship-hit"):s.classList.add("ship")}}#U(t,e,n,i){const r=i?e.x:e.y,s=i?e.y:e.x,o=s+n;for(let e=s;e<o;++e){const n=(i?r:e)+(i?e:r)*this.#a,s=t.children[n];s.classList.remove(["attack-hit","attack-fail"]),s.classList.add("attack-sunk")}}#R(t,e){if(!e)return;const n=t.position.x+t.position.y*this.#a,i=e.children[n];i.classList.remove(["attack-hit","attack-fail"]),t.hit?t.ship.sunk?this.#U(e,t.ship.position,t.ship.length,t.ship.isUp):i.classList.add("attack-hit"):i.classList.add("attack-fail")}unRender(){i.unlisten("game:shipPlacementChanged",this.#v),i.unlisten("game:opponentReceiveAttack",this.#S),i.unlisten("game:playerReceiveAttack",this.#x),i.unlisten("game:startTurn",this.#C)}renderContent(){const t=document.createElement("div");t.id="gameboardView",this.#P(t),this.#B(t),this.#A(t),this.root.appendChild(t)}updateShipBoard(t){if(this.#b)for(const e of t)this.#E(e)}onOpponentReceiveAttack(t){this.#R(t,this.#f)}onPlayerReceiveAttack(t){this.#R(t,this.#b)}updateTitle(t){this.#k&&(this.#k.textContent=`${t} turn`)}}class m{#O;constructor(t){this.#O=document.createElement(t)}get element(){return this.#O}}class y extends m{constructor(t,e){if("string"!=typeof t)throw new TypeError("ButtonComponent: label must be a string");if(e&&"function"!=typeof e)throw new TypeError("ButtonComponent: onClick must be a function");super("button"),this.element.textContent=t,e&&this.element.addEventListener("click",e)}}class g extends d{constructor(t){super(t)}#I(){i.emit("game:startRequest")}renderContent(){const t=document.createElement("div");t.id="homeView";const e=document.createElement("h1");e.textContent="Battleship";const n=new y("Play",this.#I);t.appendChild(e),t.appendChild(n.element),this.root.appendChild(t)}}class b{static#L;static#z;static init(t){this.#L=t}static#M(){this.#z&&this.#z.unRender()}static navigateToHome(){this.#M(),this.#z=new g(this.#L),this.#z.render()}static navigateToGameboard(){this.#M(),this.#z=new u(this.#L,s.getBoardSize()),this.#z.render()}static navigateToEndgame(t){this.#M(),this.#z=new h(this.#L,t),this.#z.render()}}var f=n(72),k=n.n(f),v=n(825),S=n.n(v),x=n(659),C=n.n(x),w=n(56),T=n.n(w),P=n(540),B=n.n(P),A=n(113),E=n.n(A),U=n(208),R={};R.styleTagTransform=E(),R.setAttributes=T(),R.insert=C().bind(null,"head"),R.domAPI=S(),R.insertStyleElement=B(),k()(U.A,R),U.A&&U.A.locals&&U.A.locals;const O=document.getElementById("root");new class{constructor(){i.listen("game:startRequest",(()=>this.onStartRequest())),i.listen("game:startTurn",(t=>this.onTurnStart(t))),i.listen("game:switchTurn",(()=>this.onSwitchTurn())),i.listen("game:endGame",(()=>this.onEndGame()))}#V(t,e){const n=t.getPossiblePositions(e);if(0===n.length)return;const i=n[Math.floor(Math.random()*n.length)];t.addShip(i.position.x,i.position.y,i.length,i.isUp)}#N(t){const e=s.getShips();this.#V(t,e.carrier),this.#V(t,e.battleship),this.#V(t,e.destroyer),this.#V(t,e.submarine),this.#V(t,e.patrolBoat)}onStartRequest(){c.player1.gameboard=new a(s.getBoardSize()),c.player2.gameboard=new a(s.getBoardSize()),p.currentPlayer="player1",this.#N(p.players.player1.gameboard),this.#N(p.players.player2.gameboard),b.navigateToGameboard();const t="human"===p.players[p.currentPlayer].type?p.players[p.currentPlayer].gameboard:p.players.player1.gameboard;i.emit("game:shipPlacementChanged",t.ships.map((t=>({position:{x:t.position.x,y:t.position.y},length:t.length,isUp:t.isUp,hitIndexes:t.hits,sunk:t.isSunk()})))),i.emit("game:startTurn",p.players[p.currentPlayer].name)}onTurnStart(){p.players[p.currentPlayer].type===l&&i.emit("game:playBotTurn")}onSwitchTurn(){"player1"===p.currentPlayer?p.currentPlayer="player2":p.currentPlayer="player1",i.emit("game:startTurn",p.players[p.currentPlayer].name)}onEndGame(){b.navigateToEndgame(p.players[p.currentPlayer].name)}},new class{constructor(){i.listen("ui:opponentCellClicked",(t=>this.onOpponentCellClicked(t)))}onOpponentCellClicked(t){p.players[p.currentPlayer].type!==l&&(p.players.player2.gameboard.receiveAttack(t.x,t.y),i.emit("game:opponentReceiveAttack",r(p.players.player2.gameboard,t)),p.players.player2.gameboard.areAllShipSunk?i.emit("game:endGame"):i.emit("game:switchTurn"))}},new class{constructor(){i.listen("game:playBotTurn",(()=>this.onPlayBotTurn()))}onPlayBotTurn(){setTimeout((()=>this.#q()),500)}#q(){const t=p.players.player1.gameboard.getPossibleAttacks(),e=t[Math.floor(Math.random()*t.length)];p.players.player1.gameboard.receiveAttack(e.x,e.y),i.emit("game:playerReceiveAttack",r(p.players.player1.gameboard,e)),p.players.player1.gameboard.areAllShipSunk?i.emit("game:endGame"):i.emit("game:switchTurn")}},b.init(O),b.navigateToHome()})();